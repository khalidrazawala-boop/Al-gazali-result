<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Al Ghazali Academy - Professional Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- PDF Generation Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700;900&family=Old+Standard+TT:ital,wght@0,400;0,700;1,400&family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #004d3d;
            --gold: #c5a059;
            --border-color: #1e293b;
        }
        body { font-family: 'Poppins', sans-serif; background: #eef2f3; color: #1e293b; }
        .college-font { font-family: 'Cinzel Decorative', serif; }
        .classic-font { font-family: 'Old Standard TT', serif; }
        
        .admit-card {
            background: white;
            border: 8px double var(--primary);
            padding: 25px;
            position: relative;
            max-width: 600px;
            margin: auto;
            background-image: radial-gradient(circle, #f0fdf4 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .result-sheet {
            background: #fff;
            border: 2px solid #000;
            padding: 40px;
            position: relative;
            max-width: 750px;
            margin: auto;
            box-shadow: 0 0 50px rgba(0,0,0,0.1);
        }

        .result-inner-border {
            border: 1px solid #000;
            padding: 20px;
            height: 100%;
        }

        .watermark {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-30deg);
            font-size: 5rem; opacity: 0.04; font-weight: 900; color: var(--primary); pointer-events: none; z-index: 0;
            white-space: nowrap;
        }

        @media print {
            .no-print { display: none !important; }
            body { background: white !; padding: 0; }
            .print-area { box-shadow: none !important; border: 1px solid #000 !important; width: 100% !important; margin: 0 !important; }
        }

        .stamp {
            border: 3px double #d1d5db;
            color: #d1d5db;
            font-size: 10px;
            font-weight: bold;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            transform: rotate(-15deg);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function App() {
            const [page, setPage] = useState('home');
            const [rollSearch, setRollSearch] = useState('');
            const [currentStudent, setCurrentStudent] = useState(null);
            const [adminPin, setAdminPin] = useState('');
            const [isAuthorized, setIsAuthorized] = useState(false);
            const [adminTab, setAdminTab] = useState('admit');

            // --- DATABASE LOGIC (STRICT) ---
            const [admitDb, setAdmitDb] = useState(() => {
                const saved = localStorage.getItem('GHAZALI_ADMIT_V4');
                return saved ? JSON.parse(saved) : {};
            });

            const [resultDb, setResultDb] = useState(() => {
                const saved = localStorage.getItem('GHAZALI_RESULT_V4');
                return saved ? JSON.parse(saved) : {};
            });

            // Auto-save whenever DB changes
            useEffect(() => {
                localStorage.setItem('GHAZALI_ADMIT_V4', JSON.stringify(admitDb));
            }, [admitDb]);

            useEffect(() => {
                localStorage.setItem('GHAZALI_RESULT_V4', JSON.stringify(resultDb));
            }, [resultDb]);

            // Form States
            const [admitForm, setAdmitForm] = useState({ roll: '', name: '', father: '', class: '', center: 'Al Ghazali Main Campus', examDate: '2026-03-20', examTime: '09:00 AM' });
            const [resultForm, setResultForm] = useState({ roll: '', s1: 'Quran Kareem', m1: '', s2: 'Hadith Studies', m2: '', s3: 'Islamic Fiqh', m3: '', s4: 'Arabic Lang', m4: '', s5: 'Urdu Lit', m5: '', s6: 'English', m6: '' });

            const downloadPDF = (id, filename) => {
                const element = document.getElementById(id);
                const opt = {
                    margin: 0.5,
                    filename: filename + '.pdf',
                    image: { type: 'jpeg', quality: 0.98 },
                    html2canvas: { scale: 2 },
                    jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
                };
                html2pdf().set(opt).from(element).save();
            };

            const handleSearch = (type) => {
                const roll = rollSearch.trim();
                if (!roll) { alert("Please enter Roll Number"); return; }
                
                const aData = admitDb[roll];
                const rData = resultDb[roll];

                if (type === 'admit') {
                    if (aData) { setCurrentStudent(aData); setPage('admit-view'); }
                    else alert("Roll Number " + roll + " ka Admit Card nahi mila!");
                } else {
                    if (aData && rData) { 
                        setCurrentStudent({ ...aData, ...rData }); 
                        setPage('result-view'); 
                    }
                    else if (!aData) alert("Pehle is Roll Number ka Admit Card banayein!");
                    else alert("Is student ka Result abhi upload nahi hua.");
                }
            };

            const calculate = (stu) => {
                const marks = [stu.m1, stu.m2, stu.m3, stu.m4, stu.m5, stu.m6].map(m => Number(m) || 0);
                const total = marks.reduce((a, b) => a + b, 0);
                const perc = ((total / 600) * 100).toFixed(2);
                let grade = 'F';
                if(perc >= 80) grade = 'A+';
                else if(perc >= 70) grade = 'A';
                else if(perc >= 60) grade = 'B';
                else if(perc >= 50) grade = 'C';
                else if(perc >= 33) grade = 'D';
                return { total, perc, status: perc >= 33 ? 'PASSED' : 'FAILED', grade };
            };

            const saveAdmit = () => {
                if(!admitForm.roll) { alert("Roll Number zaruri hai!"); return; }
                setAdmitDb(prev => ({ ...prev, [admitForm.roll]: admitForm }));
                alert("Admit Card Saved Successfully!");
            };

            const saveResult = () => {
                if(!resultForm.roll) { alert("Roll Number zaruri hai!"); return; }
                setResultDb(prev => ({ ...prev, [resultForm.roll]: resultForm }));
                alert("Marksheet Updated Successfully!");
            };

            return (
                <div className="min-h-screen flex flex-col">
                    {/* Navbar */}
                    <nav className="bg-[#004d3d] text-white p-4 flex justify-between items-center no-print shadow-xl">
                        <div className="flex items-center gap-2 cursor-pointer" onClick={() => setPage('home')}>
                            <div className="bg-white text-[#004d3d] w-10 h-10 rounded-full flex items-center justify-center font-black shadow-inner">G</div>
                            <span className="font-bold text-lg college-font italic">Al Ghazali Academy</span>
                        </div>
                        <button onClick={() => setPage('login')} className="text-[10px] bg-white text-[#004d3d] px-4 py-1.5 rounded-full font-black uppercase tracking-tighter hover:bg-gray-200">Staff Login</button>
                    </nav>

                    {/* Home Page */}
                    {page === 'home' && (
                        <div className="flex-grow flex items-center justify-center p-6">
                            <div className="bg-white p-12 rounded-[3rem] shadow-2xl w-full max-w-md text-center border-t-[15px] border-[#004d3d]">
                                <h2 className="text-2xl font-black text-gray-800 mb-8 uppercase college-font">Online Portal 2026</h2>
                                <div className="relative mb-8">
                                    <input 
                                        type="text" placeholder="Roll Number" 
                                        className="w-full p-6 bg-gray-50 border-4 border-gray-100 rounded-3xl text-center text-4xl font-black focus:border-[#c5a059] outline-none text-[#004d3d] transition-all"
                                        value={rollSearch}
                                        onChange={(e) => setRollSearch(e.target.value)}
                                    />
                                    <div className="absolute -top-3 left-1/2 transform -translate-x-1/2 bg-white px-4 text-[10px] font-bold text-gray-400">ENTER ROLL NO</div>
                                </div>
                                <div className="grid grid-cols-1 gap-4">
                                    <button onClick={() => handleSearch('admit')} className="bg-[#004d3d] text-white py-5 rounded-2xl font-black shadow-xl hover:bg-black transition-all text-lg">üé´ DOWNLOAD ADMIT CARD</button>
                                    <button onClick={() => handleSearch('result')} className="bg-[#c5a059] text-white py-4 rounded-2xl font-black shadow-lg hover:opacity-90 transition-all">üìú CHECK MARKSHEET</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Admit Card View */}
                    {page === 'admit-view' && currentStudent && (
                        <div className="p-4 flex flex-col items-center">
                            <div className="no-print flex gap-2 mb-4">
                                <button onClick={() => setPage('home')} className="bg-white px-6 py-2 rounded-full shadow font-bold text-sm">‚Üê Back</button>
                                <button onClick={() => downloadPDF('admit-area', 'Admit_Card_'+currentStudent.roll)} className="bg-blue-600 text-white px-6 py-2 rounded-full shadow font-bold text-sm">‚¨á Download PDF</button>
                            </div>
                            <div id="admit-area" className="admit-card print-area">
                                <div className="watermark">AL GHAZALI</div>
                                <div className="text-center border-b-4 border-[#004d3d] pb-4 mb-6">
                                    <h1 className="college-font text-3xl font-black text-[#004d3d]">AL GHAZALI ACADEMY</h1>
                                    <p className="text-[10px] font-bold tracking-[4px] uppercase text-gray-500">Academic Session 2025-26</p>
                                    <div className="mt-4 bg-[#004d3d] text-white inline-block px-8 py-1.5 text-xs font-black rounded-lg">OFFICIAL ADMIT CARD</div>
                                </div>
                                <div className="grid grid-cols-2 gap-y-6 text-[11px] font-bold uppercase">
                                    <div className="flex flex-col"><span className="text-gray-400 text-[8px]">NAME OF STUDENT</span> {currentStudent.name}</div>
                                    <div className="flex flex-col"><span className="text-gray-400 text-[8px]">ROLL NUMBER</span> {currentStudent.roll}</div>
                                    <div className="flex flex-col"><span className="text-gray-400 text-[8px]">FATHER'S NAME</span> {currentStudent.father}</div>
                                    <div className="flex flex-col"><span className="text-gray-400 text-[8px]">CLASS / GRADE</span> {currentStudent.class}</div>
                                    <div className="flex flex-col"><span className="text-gray-400 text-[8px]">EXAMINATION DATE</span> {currentStudent.examDate}</div>
                                    <div className="flex flex-col"><span className="text-gray-400 text-[8px]">REPORTING TIME</span> {currentStudent.examTime}</div>
                                    <div className="col-span-2 flex flex-col"><span className="text-gray-400 text-[8px]">EXAMINATION VENUE</span> {currentStudent.center}</div>
                                </div>
                                <div className="mt-12 flex justify-between items-center">
                                    <div className="stamp uppercase">GHAZALI<br/>OFFICIAL</div>
                                    <div className="text-center">
                                        <div className="border-t-2 border-black w-32 pt-1 font-black text-[9px] uppercase">Exam Controller</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Result Marksheet View */}
                    {page === 'result-view' && currentStudent && (() => {
                        const r = calculate(currentStudent);
                        return (
                            <div className="p-4 flex flex-col items-center">
                                <div className="no-print flex gap-2 mb-4">
                                    <button onClick={() => setPage('home')} className="bg-white px-6 py-2 rounded-full shadow font-bold text-sm">‚Üê Back</button>
                                    <button onClick={() => downloadPDF('result-area', 'Result_'+currentStudent.roll)} className="bg-green-600 text-white px-6 py-2 rounded-full shadow font-bold text-sm">‚¨á Download PDF</button>
                                </div>
                                <div id="result-area" className="result-sheet print-area">
                                    <div className="result-inner-border">
                                        <div className="watermark">CERTIFIED</div>
                                        <div className="text-center mb-8">
                                            <h2 className="college-font text-4xl font-black text-[#004d3d] leading-none">AL GHAZALI ACADEMY</h2>
                                            <p className="text-[10px] font-black tracking-widest text-gray-500 mt-2">REGD. ISLAMIC GIRLS BOARDING SCHOOL</p>
                                            <div className="h-1 w-48 bg-[#c5a059] mx-auto my-4"></div>
                                            <h3 className="font-bold text-lg classic-font italic underline decoration-[#c5a059]">ANNUAL EXAMINATION STATEMENT OF MARKS</h3>
                                        </div>
                                        
                                        <div className="grid grid-cols-3 gap-4 mb-8 text-[11px] font-bold border p-4 bg-gray-50 rounded">
                                            <div><span className="text-gray-400 block text-[8px]">STUDENT NAME</span> {currentStudent.name}</div>
                                            <div><span className="text-gray-400 block text-[8px]">ROLL NUMBER</span> {currentStudent.roll}</div>
                                            <div><span className="text-gray-400 block text-[8px]">FATHER'S NAME</span> {currentStudent.father}</div>
                                        </div>

                                        <table className="w-full mb-10 border-2 border-black">
                                            <thead>
                                                <tr className="bg-gray-800 text-white text-[10px] uppercase">
                                                    <th className="p-3 border text-left">SUBJECT DESCRIPTION</th>
                                                    <th className="p-3 border w-24">MAX MARKS</th>
                                                    <th className="p-3 border w-24">OBTAINED</th>
                                                </tr>
                                            </thead>
                                            <tbody className="font-bold text-sm">
                                                {[1,2,3,4,5,6].map(i => (
                                                    <tr key={i} className="border-b border-black">
                                                        <td className="p-3 border italic text-gray-700">{currentStudent[`s${i}`]}</td>
                                                        <td className="p-3 border text-center text-gray-400">100</td>
                                                        <td className="p-3 border text-center">{currentStudent[`m${i}`] || '0'}</td>
                                                    </tr>
                                                ))}
                                                <tr className="bg-gray-100 text-xl font-black">
                                                    <td className="p-4 text-right border uppercase">Total Aggregate</td>
                                                    <td className="p-4 text-center border">600</td>
                                                    <td className="p-4 text-center border bg-white">{r.total}</td>
                                                </tr>
                                            </tbody>
                                        </table>

                                        <div className="grid grid-cols-3 gap-6 text-center border-t-4 border-[#004d3d] pt-8">
                                            <div>
                                                <p className="text-[9px] font-bold text-gray-400 uppercase">PERCENTAGE</p>
                                                <p className="text-3xl font-black text-[#004d3d]">{r.perc}%</p>
                                            </div>
                                            <div>
                                                <p className="text-[9px] font-bold text-gray-400 uppercase">GRADE</p>
                                                <p className="text-3xl font-black text-[#c5a059]">{r.grade}</p>
                                            </div>
                                            <div>
                                                <p className="text-[9px] font-bold text-gray-400 uppercase">RESULT</p>
                                                <p className={`text-3xl font-black ${r.status === 'PASSED' ? 'text-green-600' : 'text-red-600'}`}>{r.status}</p>
                                            </div>
                                        </div>

                                        <div className="mt-16 flex justify-between px-4">
                                            <div className="text-center">
                                                <div className="h-0.5 bg-gray-400 w-32 mb-1"></div>
                                                <p className="text-[9px] font-bold uppercase italic">Class Teacher</p>
                                            </div>
                                            <div className="text-center">
                                                <div className="h-0.5 bg-gray-400 w-32 mb-1"></div>
                                                <p className="text-[9px] font-bold uppercase italic">Principal Signature</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        );
                    }
