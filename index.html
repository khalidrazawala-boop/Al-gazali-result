<!DOCTYPE html>
<html lang="ur" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AL GAZALI ONLINE GIRLS ACADEMY</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & Babel -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Nastaliq+Urdu:wght@400;700&family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <style>
        body { font-family: 'Poppins', sans-serif; background-color: #f1f5f9; margin: 0; padding: 0; }
        .urdu-text { font-family: 'Noto Nastaliq Urdu', serif !important; line-height: 2.5; text-align: center; }
        .glass-card { background: white; border-radius: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        .header-bg { background: linear-gradient(to right, #064e3b, #065f46); }
        @media print { .no-print { display: none !important; } .print-area { width: 100% !important; border: none !important; } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Firebase Setup
        let firebaseConfig = {};
        try {
            firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        } catch (e) { console.error("Config missing"); }

        const appId = typeof __app_id !== 'undefined' ? __app_id : 'al-gazali-main';

        if (!firebase.apps.length && firebaseConfig.apiKey) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.apps.length ? firebase.firestore() : null;
        const auth = firebase.apps.length ? firebase.auth() : null;

        const App = () => {
            const [view, setView] = useState('home'); 
            const [loading, setLoading] = useState(false);
            const [adminPass, setAdminPass] = useState('');
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [rollNoInput, setRollNoInput] = useState('');
            const [studentData, setStudentData] = useState(null);

            // New Entry State
            const [entry, setEntry] = useState({
                name: '', rollNo: '', father: '', className: '', session: '2024-25',
                subjects: Array(6).fill({ name: '', marks: '' })
            });

            useEffect(() => {
                if (auth) auth.signInAnonymously().catch(() => {});
            }, []);

            const findStudent = async (targetView) => {
                if (!rollNoInput) return alert("Roll Number likhein");
                if (!db) return alert("System connect nahi hai");
                setLoading(true);
                try {
                    const docRef = db.doc(`artifacts/${appId}/public/data/students/${rollNoInput}`);
                    const snap = await docRef.get();
                    if (snap.exists) {
                        setStudentData(snap.data());
                        setView(targetView);
                    } else {
                        alert("Record nahi mila!");
                    }
                } catch (e) { alert("Error fetching data"); }
                finally { setLoading(false); }
            };

            const saveEntry = async () => {
                if (!entry.name || !entry.rollNo) return alert("Naam aur Roll No zaroori hain");
                setLoading(true);
                try {
                    await db.doc(`artifacts/${appId}/public/data/students/${entry.rollNo}`).set({
                        ...entry,
                        lastUpdate: new Date().toISOString()
                    });
                    alert("Data save ho gaya!");
                    setEntry({
                        name: '', rollNo: '', father: '', className: '', session: '2024-25',
                        subjects: Array(6).fill({ name: '', marks: '' })
                    });
                } catch (e) { alert("Save error: " + e.message); }
                finally { setLoading(false); }
            };

            return (
                <div className="min-h-screen pb-10">
                    <header className="header-bg text-white py-12 px-4 text-center no-print">
                        <h1 className="text-3xl md:text-5xl font-bold tracking-tight">AL GAZALI ONLINE GIRLS ACADEMY</h1>
                        <p className="urdu-text text-2xl mt-4 opacity-90">تعلیم و تربیت کا بہترین مرکز</p>
                    </header>

                    <main className="max-w-4xl mx-auto px-4 -mt-10">
                        {view === 'home' && (
                            <div className="grid md:grid-cols-2 gap-6">
                                <div className="glass-card p-8 border-t-8 border-emerald-900">
                                    <h2 className="text-xl font-bold mb-4">STUDENT SERVICES</h2>
                                    <input 
                                        type="text" placeholder="Roll Number" 
                                        className="w-full p-4 border-2 rounded-xl mb-4 text-center text-2xl font-bold"
                                        value={rollNoInput} onChange={e => setRollNoInput(e.target.value)}
                                    />
                                    <button onClick={() => findStudent('result')} className="w-full bg-emerald-800 text-white py-4 rounded-xl font-bold mb-3 shadow-lg">VIEW RESULT</button>
                                    <button onClick={() => findStudent('admit')} className="w-full bg-teal-600 text-white py-4 rounded-xl font-bold shadow-lg">ADMIT CARD</button>
                                </div>
                                <div className="glass-card p-8 border-t-8 border-orange-500 flex flex-col justify-center">
                                    <h2 className="text-xl font-bold mb-2">ADMIN PANEL</h2>
                                    <p className="text-gray-400 text-sm mb-6">Staff login for entry</p>
                                    <button onClick={() => setView('admin')} className="w-full bg-orange-600 text-white py-4 rounded-xl font-bold">LOGIN ADMIN</button>
                                </div>
                            </div>
                        )}

                        {view === 'admin' && (
                            <div className="glass-card p-6 md:p-10 mb-10">
                                {!isLoggedIn ? (
                                    <div className="text-center py-10">
                                        <h2 className="text-2xl font-bold mb-6">Staff Authentication</h2>
                                        <input type="password" placeholder="Passcode (1234)" className="p-4 border rounded-xl text-center text-xl mb-6 block mx-auto w-64" value={adminPass} onChange={e => setAdminPass(e.target.value)}/>
                                        <button onClick={() => adminPass === '1234' ? setIsLoggedIn(true) : alert("Wrong Password")} className="bg-black text-white px-12 py-3 rounded-xl font-bold">LOGIN</button>
                                        <button onClick={() => setView('home')} className="block mx-auto mt-4 text-gray-400">Cancel</button>
                                    </div>
                                ) : (
                                    <div className="space-y-6">
                                        <div className="flex justify-between items-center border-b pb-4">
                                            <h2 className="text-xl font-bold">NEW STUDENT ENTRY</h2>
                                            <button onClick={() => setIsLoggedIn(false)} className="text-red-500 font-bold">Logout</button>
                                        </div>
                                        <div className="grid grid-cols-2 gap-4">
                                            <input placeholder="Name" className="p-3 border rounded-lg" value={entry.name} onChange={e => setEntry({...entry, name: e.target.value})}/>
                                            <input placeholder="Roll Number" className="p-3 border rounded-lg" value={entry.rollNo} onChange={e => setEntry({...entry, rollNo: e.target.value})}/>
                                            <input placeholder="Father Name" className="p-3 border rounded-lg" value={entry.father} onChange={e => setEntry({...entry, father: e.target.value})}/>
                                            <input placeholder="Class" className="p-3 border rounded-lg" value={entry.className} onChange={e => setEntry({...entry, className: e.target.value})}/>
                                        </div>
                                        <div className="bg-emerald-50 p-6 rounded-xl">
                                            <h3 className="font-bold mb-4 text-emerald-900 italic">Add Books (Kitabon ke Naam Khud Likhain)</h3>
                                            <div className="grid md:grid-cols-2 gap-4">
                                                {entry.subjects.map((sub, i) => (
                                                    <div key={i} className="flex gap-2">
                                                        <input placeholder={`Book ${i+1}`} className="w-2/3 p-2 border rounded bg-white" value={sub.name} onChange={e => {
                                                            const s = [...entry.subjects]; s[i] = {...s[i], name: e.target.value}; setEntry({...entry, subjects: s});
                                                        }}/>
                                                        <input placeholder="Marks" type="number" className="w-1/3 p-2 border rounded bg-white text-center" value={sub.marks} onChange={e => {
                                                            const s = [...entry.subjects]; s[i] = {...s[i], marks: e.target.value}; setEntry({...entry, subjects: s});
                                                        }}/>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                        <button onClick={saveEntry} disabled={loading} className="w-full bg-emerald-800 text-white py-4 rounded-xl font-bold text-xl shadow-lg">
                                            {loading ? 'SAVING...' : 'SAVE STUDENT RECORD'}
                                        </button>
                                    </div>
                                )}
                            </div>
                        )}

                        {view === 'result' && studentData && (
                            <div className="bg-white p-6 rounded-xl shadow-2xl print-area">
                                <div className="border-[10px] border-double border-emerald-900 p-8">
                                    <div className="text-center mb-8">
                                        <h2 className="text-2xl md:text-3xl font-bold text-emerald-900">AL GAZALI ONLINE GIRLS ACADEMY</h2>
                                        <p className="urdu-text text-2xl text-emerald-700">تعلیم و تربیت کا بہترین مرکز</p>
                                        <p className="text-xs font-bold uppercase mt-2 tracking-widest border-y py-1 border-emerald-900 inline-block">Official Result Card {studentData.session}</p>
                                    </div>
                                    <div className="grid grid-cols-2 gap-6 text-sm mb-8">
                                        <div className="border-l-4 border-emerald-800 pl-4 font-bold">
                                            <p className="text-gray-400 text-[10px]">STUDENT NAME</p>
                                            <p className="text-lg uppercase">{studentData.name}</p>
                                            <p className="text-gray-400 text-[10px] mt-2">FATHER NAME</p>
                                            <p className="uppercase">{studentData.father}</p>
                                        </div>
                                        <div className="text-right border-r-4 border-emerald-800 pr-4 font-bold">
                                            <p className="text-gray-400 text-[10px]">ROLL NUMBER</p>
                                            <p className="text-lg">{studentData.rollNo}</p>
                                            <p className="text-gray-400 text-[10px] mt-2">CLASS</p>
                                            <p>{studentData.className}</p>
                                        </div>
                                    </div>
                                    <table className="w-full text-sm mb-8 border-collapse">
                                        <thead className="bg-emerald-900 text-white uppercase text-[10px]">
                                            <tr><th className="p-3 text-left">Subject / Kitab</th><th className="p-3 text-center">Marks</th></tr>
                                        </thead>
                                        <tbody>
                                            {studentData.subjects.map((s, i) => s.name && (
                                                <tr key={i} className="border-b border-emerald-50"><td className="p-3 font-bold text-gray-700 uppercase">{s.name}</td><td className="p-3 text-center font-black text-xl">{s.marks}</td></tr>
                                            ))}
                                        </tbody>
                                        <tfoot className="bg-emerald-900 text-white">
                                            <tr className="font-black"><td className="p-4 text-right">OBTAINED MARKS</td><td className="p-4 text-center text-3xl">
                                                {studentData.subjects.reduce((a, b) => a + (Number(b.marks) || 0), 0)}
                                            </td></tr>
                                        </tfoot>
                                    </table>
                                    <div className="flex justify-between mt-16 px-4">
                                        <div className="text-center w-32 border-t pt-1 font-bold text-[10px]">EXAM CONTROLLER</div>
                                        <div className="text-center w-32 border-t pt-1 font-bold text-[10px]">PRINCIPAL SEAL</div>
                                    </div>
                                </div>
                                <div className="no-print mt-6 flex gap-4">
                                    <button onClick={() => window.print()} className="flex-1 bg-emerald-900 text-white py-4 rounded-xl font-bold">PRINT MARK SHEET</button>
                                    <button onClick={() => setView('home')} className="px-10 bg-gray-100 py-4 rounded-xl font-bold">BACK</button>
                                </div>
                            </div>
                        )}

                        {view === 'admit' && studentData && (
                            <div className="bg-white p-6 rounded-xl shadow-2xl print-area">
                                <div className="border-4 border-emerald-800 p-8 relative">
                                    <div className="flex justify-between items-start mb-8 border-b-2 border-emerald-800 pb-4">
                                        <div>
                                            <h2 className="text-xl font-bold text-emerald-900">AL GAZALI ONLINE ACADEMY</h2>
                                            <p className="text-[10px] font-bold uppercase text-orange-600">Provisional Admit Card</p>
                                        </div>
                                        <div className="w-20 h-24 border-2 border-gray-200 bg-gray-50 flex items-center justify-center text-[8px] text-gray-400 p-2 text-center">Student Photo</div>
                                    </div>
                                    <div className="grid grid-cols-2 gap-8 mb-10 text-sm">
                                        <div><p className="text-[10px] text-gray-400 font-bold">STUDENT NAME</p><p className="font-bold border-b text-lg">{studentData.name}</p></div>
                                        <div><p className="text-[10px] text-gray-400 font-bold">ROLL NUMBER</p><p className="font-bold border-b text-lg">{studentData.rollNo}</p></div>
                                        <div><p className="text-[10px] text-gray-400 font-bold">FATHER NAME</p><p className="font-bold border-b">{studentData.father}</p></div>
                                        <div><p className="text-[10px] text-gray-400 font-bold">CLASS</p><p className="font-bold border-b">{studentData.className}</p></div>
                                    </div>
                                    <div className="bg-emerald-50 p-4 rounded text-[10px] font-bold text-emerald-800">
                                        <p>IMPORTANT: Please login to the portal 15 minutes before exam. Ensure stable internet connection.</p>
                                    </div>
                                    <div className="mt-12 flex justify-end"><p className="border-t w-32 text-center text-[10px] pt-1 font-bold">Authorized Sign</p></div>
                                </div>
                                <div className="no-print mt-6 flex gap-4">
                                    <button onClick={() => window.print()} className="flex-1 bg-teal-600 text-white py-4 rounded-xl font-bold">DOWNLOAD SLIP</button>
                                    <button onClick={() => setView('home')} className="px-10 bg-gray-100 py-4 rounded-xl font-bold">BACK</button>
                                </div>
                            </div>
                        )}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

